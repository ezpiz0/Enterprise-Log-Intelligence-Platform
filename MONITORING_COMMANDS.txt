=============================================================================
üìä PROMETHEUS & GRAFANA –ú–û–ù–ò–¢–û–†–ò–ù–ì - –®–ü–ê–†–ì–ê–õ–ö–ê –ö–û–ú–ê–ù–î
=============================================================================

üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢
----------------
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (FastAPI + Prometheus + Grafana)
docker-compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# 4. –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
FastAPI:    http://localhost:8001
–ú–µ—Ç—Ä–∏–∫–∏:    http://localhost:8001/metrics
Prometheus: http://localhost:9090
Grafana:    http://localhost:3000 (admin/admin)


üìà PROMETHEUS
-------------
# –û—Ç–∫—Ä—ã—Ç—å Prometheus UI
http://localhost:9090

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å targets (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å UP)
http://localhost:9090/targets

# –ü—Ä–∏–º–µ—Ä—ã PromQL –∑–∞–ø—Ä–æ—Å–æ–≤:
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã: sum(http_requests_total)
- RPS: rate(http_requests_total[5m])
- P95 latency: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))
- –ü–∞–º—è—Ç—å: memory_usage_bytes{type="rss"}
- –ê–Ω–æ–º–∞–ª–∏–∏: sum(anomalies_detected_total)


üìä GRAFANA
----------
# –û—Ç–∫—Ä—ã—Ç—å Grafana
http://localhost:3000

# –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
admin / admin

# –î–∞—à–±–æ—Ä–¥
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: "FastAPI Log Analyzer - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å datasource
Configuration ‚Üí Data Sources ‚Üí Prometheus ‚Üí Test


üê≥ DOCKER –ö–û–ú–ê–ù–î–´
-----------------
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (–¥–∞–Ω–Ω—ã–µ Prometheus –∏ Grafana)
docker-compose down -v

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å
docker-compose restart fastapi-app
docker-compose restart prometheus
docker-compose restart grafana

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker logs fastapi-log-analyzer
docker logs prometheus
docker logs grafana

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs -f fastapi-log-analyzer

# –ó–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it fastapi-log-analyzer bash
docker exec -it prometheus sh
docker exec -it grafana bash


üîç –ü–†–û–í–ï–†–ö–ê –ú–ï–¢–†–ò–ö
------------------
# –õ–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Docker)
python main.py
# –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8001/metrics

# –í Docker
docker-compose up -d
curl http://localhost:8001/metrics

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–µ—Ç—Ä–∏–∫—É
curl http://localhost:8001/metrics | grep log_records_processed_total
curl http://localhost:8001/metrics | grep memory_usage_bytes


üõ†Ô∏è TROUBLESHOOTING
------------------
# Prometheus –Ω–µ –≤–∏–¥–∏—Ç FastAPI
docker-compose ps                          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker network ls                          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–∏
docker logs prometheus                     # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Prometheus (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
curl -X POST http://localhost:9090/-/reload

# Grafana –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å datasource: http://localhost:3000/datasources
# 2. Test connection
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω (top right)

# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose down -v
docker-compose up -d


üìä –ü–û–õ–ï–ó–ù–´–ï –ó–ê–ü–†–û–°–´ PROMETHEUS
------------------------------
# HTTP –º–µ—Ç—Ä–∏–∫–∏
http_requests_total                                    # –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã
rate(http_requests_total[5m])                         # RPS
sum(rate(http_requests_total{status=~"5.."}[5m]))   # Errors per second

# Latency
histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))  # p50
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))  # p95
histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))  # p99

# ML –º–µ—Ç—Ä–∏–∫–∏
rate(log_analysis_duration_seconds_sum[5m]) / rate(log_analysis_duration_seconds_count[5m])  # Avg time
sum(log_records_processed_total)                                                               # Total records
increase(anomalies_detected_total[1h])                                                         # Anomalies per hour

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
memory_usage_bytes{type="rss"}                        # Physical memory
memory_usage_bytes{type="vms"}                        # Virtual memory
active_websocket_connections                          # WebSocket count

# –ü–æ –º–æ–¥–µ–ª—è–º
sum by (model_type) (log_records_processed_total)     # Records by model
sum by (model_type) (anomalies_detected_total)        # Anomalies by model


üîß –ù–ê–°–¢–†–û–ô–ö–ê
------------
# –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å Grafana
# –í docker-compose.yml:
- GF_SECURITY_ADMIN_PASSWORD=NEW_PASSWORD

# –ò–∑–º–µ–Ω–∏—Ç—å retention time Prometheus
# –í docker-compose.yml (command):
'--storage.tsdb.retention.time=7d'  # –í–º–µ—Å—Ç–æ 30d

# –ò–∑–º–µ–Ω–∏—Ç—å scrape interval
# –í prometheus.yml:
scrape_interval: 30s  # –í–º–µ—Å—Ç–æ 15s


üìù –§–ê–ô–õ–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
---------------------
docker-compose.yml                                # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
prometheus.yml                                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
grafana/provisioning/datasources/prometheus.yml  # Datasource
grafana/provisioning/dashboards/default.yml      # Dashboard provider
grafana/dashboards/logs-analysis.json            # –î–∞—à–±–æ—Ä–¥


üìñ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø
---------------
MONITORING_GUIDE.md         # –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
MONITORING_QUICKSTART.md    # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
MONITORING_CHANGES.md       # –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
MONITORING_COMMANDS.txt     # –≠—Ç–æ—Ç —Ñ–∞–π–ª


‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
---------------
1. docker-compose up -d
2. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8001
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π ZIP —Ñ–∞–π–ª
4. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana http://localhost:3000
5. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–∞–Ω–µ–ª–∏ –¥–∞—à–±–æ—Ä–¥–∞


üéâ –ì–û–¢–û–í–û!
----------
–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–û—Å–Ω–æ–≤–Ω—ã–µ URL:
- FastAPI:    http://localhost:8001
- –ú–µ—Ç—Ä–∏–∫–∏:    http://localhost:8001/metrics
- Prometheus: http://localhost:9090
- Grafana:    http://localhost:3000

–õ–æ–≥–∏–Ω Grafana: admin / admin

=============================================================================


