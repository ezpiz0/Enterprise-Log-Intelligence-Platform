<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOps Analytics Dashboard - Atomichack 3.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        /* ========== CORE HIGH-TECH NEON THEME ========== */
        :root {
            /* Background Colors */
            --bg-primary: #0A0A0A;
            --bg-secondary: #121212;
            --bg-card: rgba(18, 18, 18, 0.85);
            
            /* Neon Accent Colors */
            --neon-cyan: #FF994E;
            --neon-cyan-glow: rgba(255, 153, 78, 0.5);
            
            /* Status Colors with Neon Effect */
            --critical: #FF4136;
            --critical-glow: rgba(255, 65, 54, 0.6);
            --warning: #FFA500;
            --warning-glow: rgba(255, 165, 0, 0.6);
            --info: #FFDC00;
            --info-glow: rgba(255, 220, 0, 0.6);
            --prediction: #9932CC;
            --prediction-glow: rgba(153, 50, 204, 0.6);
            --success: #FF994E;
            --success-glow: rgba(255, 153, 78, 0.6);
            
            /* Text Colors */
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-dim: #707070;
            
            /* Fonts */
            --font-display: 'Orbitron', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-display);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        /* ========== NEON GLOW EFFECTS ========== */
        .glow-cyan {
            box-shadow: 0 0 20px var(--neon-cyan-glow),
                        0 0 40px var(--neon-cyan-glow),
                        inset 0 0 20px rgba(0, 255, 255, 0.1);
        }
        
        .glow-critical {
            box-shadow: 0 0 15px var(--critical-glow),
                        0 0 30px var(--critical-glow);
        }
        
        .glow-warning {
            box-shadow: 0 0 15px var(--warning-glow),
                        0 0 30px var(--warning-glow);
        }
        
        .glow-success {
            box-shadow: 0 0 15px var(--success-glow),
                        0 0 30px var(--success-glow);
        }
        
        /* ========== LAYOUT ========== */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
            padding-bottom: 150px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è Timeline Scrubber */
        }
        
        /* ========== HEADER ========== */
        .header {
            background: var(--bg-card);
            border: 1px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 25px 35px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px var(--neon-cyan-glow),
                        inset 0 0 30px rgba(0, 255, 255, 0.05);
        }
        
        .header h1 {
            font-size: 2em;
            font-weight: 900;
            color: var(--neon-cyan);
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 20px var(--neon-cyan-glow),
                         0 0 40px var(--neon-cyan-glow);
        }
        
        .header-subtitle {
            font-family: var(--font-mono);
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* ========== BUTTONS ========== */
        .btn {
            font-family: var(--font-display);
            font-weight: 600;
            padding: 12px 24px;
            border: 2px solid var(--neon-cyan);
            border-radius: 8px;
            background: transparent;
            color: var(--neon-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9em;
        }
        
        .btn:hover {
            background: var(--neon-cyan);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--neon-cyan-glow),
                        0 0 40px var(--neon-cyan-glow);
            transform: translateY(-2px);
        }
        
        .btn-success {
            border-color: var(--success);
            color: var(--success);
        }
        
        .btn-success:hover {
            background: var(--success);
            box-shadow: 0 0 20px var(--success-glow);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        /* ========== KPI CARDS ========== */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px var(--neon-cyan-glow),
                        inset 0 0 30px rgba(0, 255, 255, 0.1);
        }
        
        .kpi-label {
            font-family: var(--font-display);
            font-size: 0.85em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }
        
        .kpi-value {
            font-family: var(--font-mono);
            font-size: 3em;
            font-weight: 700;
            color: var(--neon-cyan);
            text-shadow: 0 0 20px var(--neon-cyan-glow);
            line-height: 1;
        }
        
        .kpi-sublabel {
            font-family: var(--font-mono);
            font-size: 0.8em;
            color: var(--text-dim);
            margin-top: 8px;
        }
        
        /* ========== CHART CONTAINERS ========== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1),
                        inset 0 0 20px rgba(0, 255, 255, 0.05);
        }
        
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-title {
            font-family: var(--font-display);
            font-size: 1.2em;
            font-weight: 700;
            color: var(--neon-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--neon-cyan-glow);
        }
        
        .chart-canvas {
            max-height: 350px;
        }
        
        /* ========== TABLE ========== */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            overflow-x: auto;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1),
                        inset 0 0 20px rgba(0, 255, 255, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--font-mono);
        }
        
        thead {
            background: rgba(0, 255, 255, 0.1);
            border-bottom: 2px solid var(--neon-cyan);
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--neon-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85em;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }
        
        tbody tr {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        tbody tr:hover {
            background: rgba(0, 255, 255, 0.05);
            box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.1);
        }
        
        /* ========== PRIORITY BADGES ========== */
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-family: var(--font-display);
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .badge-critical {
            background: var(--critical);
            color: #000;
            box-shadow: 0 0 15px var(--critical-glow);
        }
        
        .badge-high {
            background: var(--warning);
            color: #000;
            box-shadow: 0 0 15px var(--warning-glow);
        }
        
        .badge-medium {
            background: var(--info);
            color: #000;
            box-shadow: 0 0 15px var(--info-glow);
        }
        
        .badge-low {
            background: var(--success);
            color: #000;
            box-shadow: 0 0 15px var(--success-glow);
        }
        
        /* ========== MODALS ========== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 35px;
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 0 50px var(--neon-cyan-glow),
                        inset 0 0 30px rgba(0, 255, 255, 0.05);
            position: relative;
            animation: slideIn 0.4s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--neon-cyan);
        }
        
        .modal-title {
            font-family: var(--font-display);
            font-size: 1.5em;
            font-weight: 700;
            color: var(--neon-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 15px var(--neon-cyan-glow);
        }
        
        .modal-close {
            background: transparent;
            border: 2px solid var(--critical);
            color: var(--critical);
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: var(--critical);
            color: #000;
            transform: rotate(90deg);
            box-shadow: 0 0 20px var(--critical-glow);
        }
        
        /* ========== INCIDENT EXPLORER ========== */
        .incident-section {
            margin-bottom: 25px;
        }
        
        .incident-section-title {
            font-family: var(--font-display);
            font-size: 1em;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .incident-section-title::before {
            content: "‚ñ∂";
            color: var(--neon-cyan);
        }
        
        .log-snippet {
            background: rgba(0, 0, 0, 0.5);
            border-left: 4px solid var(--critical);
            padding: 15px;
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 0.85em;
            color: var(--text-primary);
            white-space: pre-wrap;
            overflow-x: auto;
            line-height: 1.6;
            box-shadow: inset 0 0 20px rgba(255, 65, 54, 0.1);
        }
        
        .log-line {
            margin: 3px 0;
        }
        
        .log-line.highlight {
            background: rgba(255, 65, 54, 0.2);
            color: var(--critical);
            font-weight: 600;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0, 255, 255, 0.05);
            border-left: 3px solid var(--warning);
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .timeline-item:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.3);
        }
        
        .timeline-time {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--warning);
            min-width: 80px;
        }
        
        .timeline-content {
            font-family: var(--font-mono);
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .playbook-steps {
            list-style: none;
            padding: 0;
        }
        
        .playbook-steps li {
            margin-bottom: 12px;
            padding: 12px 15px;
            background: rgba(255, 153, 78, 0.05);
            border-left: 3px solid var(--success);
            border-radius: 6px;
            font-family: var(--font-mono);
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        
        .playbook-steps li:hover {
            background: rgba(255, 153, 78, 0.1);
            box-shadow: 0 0 15px rgba(255, 153, 78, 0.2);
        }
        
        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: var(--bg-card);
            border: 2px dashed var(--neon-cyan);
            border-radius: 12px;
            box-shadow: inset 0 0 50px rgba(0, 255, 255, 0.1);
        }
        
        .empty-state h2 {
            font-family: var(--font-display);
            font-size: 2em;
            color: var(--neon-cyan);
            margin-bottom: 15px;
            text-shadow: 0 0 20px var(--neon-cyan-glow);
        }
        
        .empty-state p {
            font-family: var(--font-mono);
            color: var(--text-secondary);
            font-size: 1.1em;
        }
        
        /* ========== LOADING STATE ========== */
        .loading {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }
        
        .loading.active {
            display: block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            border: 4px solid rgba(255, 153, 78, 0.1);
            border-top: 4px solid var(--neon-cyan);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            box-shadow: 0 0 20px var(--neon-cyan-glow);
        }
        
        .loading-text {
            font-family: var(--font-mono);
            color: var(--neon-cyan);
            font-size: 1.2em;
            text-shadow: 0 0 10px var(--neon-cyan-glow);
        }
        
        /* ========== DASHBOARD VISIBILITY ========== */
        #dashboard {
            display: none;
        }
        
        #dashboard.active {
            display: block;
        }
        
        /* ========== SYSTEM NAME MAPPING ========== */
        .system-icon {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        /* ========== TOAST NOTIFICATION ========== */
        .toast-notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--bg-card);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 20px 30px;
            min-width: 350px;
            box-shadow: 0 0 40px var(--success-glow),
                        inset 0 0 20px rgba(255, 153, 78, 0.1);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.5s ease;
        }
        
        .toast-notification.show {
            display: block;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        .toast-notification.hiding {
            animation: slideOutRight 0.5s ease;
        }
        
        .toast-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .toast-icon {
            font-size: 1.8em;
        }
        
        .toast-title {
            font-family: var(--font-display);
            font-size: 1.1em;
            font-weight: 700;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .toast-message {
            font-family: var(--font-mono);
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-left: 46px;
        }
        
        .toast-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toast-close:hover {
            color: var(--success);
            transform: rotate(90deg);
        }
        
        /* ========== TIME MACHINE TIMELINE SCRUBBER ========== */
        .timeline-scrubber {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 2px solid var(--neon-cyan);
            padding: 20px 40px;
            backdrop-filter: blur(15px);
            box-shadow: 0 -5px 30px var(--neon-cyan-glow),
                        inset 0 0 30px rgba(0, 255, 255, 0.05);
            z-index: 100;
            display: none;
        }
        
        .timeline-scrubber.active {
            display: block;
        }
        
        .timeline-container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .timeline-title {
            font-family: var(--font-display);
            font-size: 0.9em;
            font-weight: 700;
            color: var(--neon-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neon-cyan-glow);
        }
        
        .timeline-time-display {
            font-family: var(--font-mono);
            font-size: 1.1em;
            color: var(--text-primary);
            background: rgba(255, 153, 78, 0.1);
            padding: 8px 20px;
            border-radius: 8px;
            border: 1px solid var(--neon-cyan);
            box-shadow: 0 0 15px rgba(255, 153, 78, 0.2);
        }
        
        .timeline-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .timeline-slider-container {
            flex: 1;
            position: relative;
            padding: 0 10px;
        }
        
        .timeline-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 153, 78, 0.2);
            border-radius: 10px;
            outline: none;
            cursor: pointer;
            position: relative;
        }
        
        .timeline-slider::-webkit-slider-track {
            width: 100%;
            height: 8px;
            background: rgba(255, 153, 78, 0.2);
            border-radius: 10px;
        }
        
        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--neon-cyan);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 20px var(--neon-cyan-glow),
                        0 0 40px var(--neon-cyan-glow);
            transition: all 0.2s ease;
        }
        
        .timeline-slider::-webkit-slider-thumb:hover {
            width: 28px;
            height: 28px;
            box-shadow: 0 0 30px var(--neon-cyan-glow),
                        0 0 60px var(--neon-cyan-glow);
        }
        
        .timeline-slider::-moz-range-track {
            width: 100%;
            height: 8px;
            background: rgba(255, 153, 78, 0.2);
            border-radius: 10px;
        }
        
        .timeline-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--neon-cyan);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 20px var(--neon-cyan-glow),
                        0 0 40px var(--neon-cyan-glow);
            transition: all 0.2s ease;
        }
        
        .timeline-slider::-moz-range-thumb:hover {
            width: 28px;
            height: 28px;
            box-shadow: 0 0 30px var(--neon-cyan-glow),
                        0 0 60px var(--neon-cyan-glow);
        }
        
        .timeline-progress {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            height: 8px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--critical));
            border-radius: 10px;
            pointer-events: none;
            box-shadow: 0 0 15px var(--neon-cyan-glow);
        }
        
        .timeline-play-btn {
            font-family: var(--font-display);
            font-weight: 600;
            padding: 10px 20px;
            border: 2px solid var(--neon-cyan);
            border-radius: 8px;
            background: transparent;
            color: var(--neon-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85em;
            min-width: 100px;
        }
        
        .timeline-play-btn:hover {
            background: var(--neon-cyan);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--neon-cyan-glow);
            transform: translateY(-2px);
        }
        
        .timeline-play-btn.playing {
            border-color: var(--critical);
            color: var(--critical);
        }
        
        .timeline-play-btn.playing:hover {
            background: var(--critical);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--critical-glow);
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
            }
            
            .timeline-scrubber {
                padding: 15px 20px;
            }
            
            .timeline-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .timeline-controls {
                flex-direction: column;
                width: 100%;
                gap: 15px;
            }
            
            .timeline-slider-container {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div class="toast-notification" id="toast-notification">
        <button class="toast-close" onclick="closeToast()">√ó</button>
        <div class="toast-header">
            <span class="toast-icon">‚úÖ</span>
            <span class="toast-title">–£—Å–ø–µ—à–Ω–æ</span>
        </div>
        <div class="toast-message">–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω! –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –Ω–∏–∂–µ.</div>
    </div>
    
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div>
                <h1>‚ö° –ê–ù–ê–õ–ò–¢–ò–ö–ê AIOPS</h1>
                <div class="header-subtitle">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>
            </div>
            <div class="btn-group">
                <a href="/api/download-results" class="btn btn-success" id="download-btn" style="display: none;">
                    üíæ –°–ö–ê–ß–ê–¢–¨
                </a>
                <a href="/" class="btn">‚¨Ö –ì–õ–ê–í–ù–ê–Ø</a>
            </div>
        </div>
        
        <!-- EMPTY STATE -->
        <div id="empty-state" class="empty-state">
            <h2>‚ö† –î–ê–ù–ù–´–ï –ù–ï –ó–ê–ì–†–£–ñ–ï–ù–´</h2>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—Ä—Ö–∏–≤ –ª–æ–≥–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏</p>
        </div>
        
        <!-- LOADING STATE -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div class="loading-text">–û–ë–†–ê–ë–û–¢–ö–ê –î–ê–ù–ù–´–•...</div>
        </div>

        <!-- DASHBOARD CONTENT -->
        <div id="dashboard">
            <!-- KPI CARDS -->
            <div class="kpi-grid">
                <div class="kpi-card glow-cyan">
                    <div class="kpi-label">–í—Å–µ–≥–æ –ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤</div>
                    <div class="kpi-value" id="kpi-problems">0</div>
                    <div class="kpi-sublabel">–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">–ù–∞–π–¥–µ–Ω–æ –ê–Ω–æ–º–∞–ª–∏–π</div>
                    <div class="kpi-value" id="kpi-anomalies">0</div>
                    <div class="kpi-sublabel">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">–ü—Ä–æ–≥–Ω–æ–∑—ã</div>
                    <div class="kpi-value" id="kpi-predictions">0</div>
                    <div class="kpi-sublabel">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã—Ö –ø—Ä–æ–±–ª–µ–º</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ –°–∏—Å—Ç–µ–º</div>
                    <div class="kpi-value" id="kpi-systems">0</div>
                    <div class="kpi-sublabel">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã</div>
                </div>
            </div>
            
            <!-- TIMELINE CHART (NEW!) -->
            <div class="chart-container full-width">
                <div class="chart-title">üìà –î–ò–ù–ê–ú–ò–ö–ê –ò–ù–¶–ò–î–ï–ù–¢–û–í</div>
                <canvas id="timeline-chart" class="chart-canvas"></canvas>
            </div>
            
            <!-- OTHER CHARTS -->
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">üî• –ü–†–û–ë–õ–ï–ú–´ –ü–û –í–õ–ò–Ø–ù–ò–Æ</div>
                    <canvas id="impact-chart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">üñ• –ó–ê–¢–†–û–ù–£–¢–´–ï –°–ò–°–¢–ï–ú–´</div>
                    <canvas id="systems-chart"></canvas>
                </div>
            </div>
            
            <!-- CRITICAL ISSUES TABLE -->
            <div class="table-container">
                <div class="chart-title">‚ö† –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ù–¶–ò–î–ï–ù–¢–´</div>
                <table id="incidents-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ü—Ä–æ–±–ª–µ–º–∞</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–°–∏—Å—Ç–µ–º—ã</th>
                            <th>–í–ª–∏—è–Ω–∏–µ</th>
                            <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="incidents-tbody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- TIME MACHINE TIMELINE SCRUBBER -->
    <div id="timeline-scrubber" class="timeline-scrubber">
        <div class="timeline-container">
            <div class="timeline-header">
                <div class="timeline-title">‚è± –†–ï–ö–û–ù–°–¢–†–£–ö–¶–ò–Ø –ò–ù–¶–ò–î–ï–ù–¢–ê (TIME MACHINE)</div>
                <div class="timeline-time-display" id="timeline-time-display">
                    <span id="current-time-text">--:--:--</span>
                </div>
            </div>
            <div class="timeline-controls">
                <div class="timeline-slider-container">
                    <div id="timeline-progress" class="timeline-progress" style="width: 0%"></div>
                    <input 
                        type="range" 
                        id="timeline-slider" 
                        class="timeline-slider" 
                        min="0" 
                        max="100" 
                        value="100" 
                        step="1"
                    />
                </div>
                <button id="timeline-play-btn" class="timeline-play-btn">‚ñ∂ PLAY</button>
            </div>
        </div>
    </div>
    
    <!-- INCIDENT EXPLORER MODAL -->
    <div id="incident-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <div class="modal-title" id="modal-title">–û–ë–û–ó–†–ï–í–ê–¢–ï–õ–¨ –ò–ù–¶–ò–î–ï–ù–¢–û–í</div>
                    <span class="badge" id="modal-priority-badge">–ü–†–ò–û–†–ò–¢–ï–¢</span>
                </div>
                <button class="modal-close" onclick="closeIncidentModal()">√ó</button>
            </div>
            
            <div class="incident-section">
                <div class="incident-section-title">–ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞</div>
                <div class="log-snippet" id="modal-root-cause">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <div class="incident-section">
                <div class="incident-section-title">–ö–æ–Ω—Ç–µ–∫—Å—Ç –õ–æ–≥–∞</div>
                <div class="log-snippet" id="modal-context">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <div class="incident-section">
                <div class="incident-section-title">–ü–ª–∞–Ω –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è</div>
                <ul class="playbook-steps" id="modal-playbook">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </ul>
            </div>
            
            <div class="incident-section">
                <div class="incident-section-title">–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –°–æ–±—ã—Ç–∏–π</div>
                <div id="modal-timeline">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let chartsInstances = {};
        let currentData = null;
        
        // ========== TOAST NOTIFICATION ==========
        
        function showToast() {
            const toast = document.getElementById('toast-notification');
            toast.classList.add('show');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                closeToast();
            }, 5000);
        }
        
        function closeToast() {
            const toast = document.getElementById('toast-notification');
            toast.classList.add('hiding');
            
            // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å—ã –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                toast.classList.remove('show', 'hiding');
            }, 500);
        }
        
        // ========== TIME MACHINE STATE ==========
        let timeMachineState = {
            enabled: false,
            minTime: null,
            maxTime: null,
            currentActiveTime: null,
            isPlaying: false,
            playInterval: null,
            allTimestamps: []
        };
        
        // –ú–∞–ø–ø–∏–Ω–≥ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –Ω–∞ —á–∏—Ç–∞–µ–º—ã–µ –∏–º–µ–Ω–∞ —Å–∏—Å—Ç–µ–º
        const SYSTEM_NAMES = {
            'db_server_log.txt': 'üóÑ –°–µ—Ä–≤–µ—Ä –ë–î',
            'firewall_log.txt': 'üõ° –ú–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω',
            'web_server_log.txt': 'üåê –í–µ–±-—Å–µ—Ä–≤–µ—Ä',
            'app_server_log.txt': '‚öô –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π',
            'network_log.txt': 'üåê –°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞'
        };
        
        // –ú–∞–ø–ø–∏–Ω–≥ ID –ø—Ä–æ–±–ª–µ–º –Ω–∞ —á–∏—Ç–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
        const PROBLEM_NAMES = {
            1: '–û—Ç–∫–∞–∑ RAID-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞',
            2: '–ü–µ—Ä–µ–≥—Ä–µ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞',
            34: '–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –ë–î',
            41: '–°–±–æ–π –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è –¶–û–î'
        };
        
        // ========== TIME MACHINE UTILITIES ==========
        
        /**
         * Debounce —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        /**
         * –ü–∞—Ä—Å–∏—Ç timestamp –∏–∑ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞
         */
        function parseTimestamp(logStr) {
            if (!logStr) return null;
            const match = logStr.match(/(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})/);
            return match ? new Date(match[1]) : null;
        }
        
        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É –≤ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
         */
        function formatTimestamp(date) {
            if (!date) return '--:--:--';
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
        
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Time Machine –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
         */
        function initializeTimeMachine(data) {
            const timestamps = [];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ timestamps –∏–∑ ERROR –ª–æ–≥–æ–≤ (submit_report)
            // –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–Ø: —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ERROR
            const seenErrors = new Set();
            data.submit.forEach(row => {
                // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                const errorLog = row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –ø—Ä–æ–±–ª–µ–º—ã'] || row['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞'];
                if (errorLog && !seenErrors.has(errorLog)) {
                    seenErrors.add(errorLog);
                    const timestamp = parseTimestamp(errorLog);
                    if (timestamp) {
                        timestamps.push(timestamp);
                    }
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ timestamps –∏–∑ WARNING –ª–æ–≥–æ–≤ (submit_report)
            // WARNING —É–∂–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã, –Ω–æ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º Set
            const seenWarnings = new Set();
            data.submit.forEach(row => {
                // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –ø—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –∏–∑ –Ω–æ–≤–æ–π –∏–ª–∏ —Å—Ç–∞—Ä–æ–π –∫–æ–ª–æ–Ω–∫–∏
                const warningLog = row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –∞–Ω–æ–º–∞–ª–∏–∏'] || row['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞'];
                if (warningLog && !seenWarnings.has(warningLog)) {
                    seenWarnings.add(warningLog);
                    const timestamp = parseTimestamp(warningLog);
                    if (timestamp) {
                        timestamps.push(timestamp);
                    }
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º timestamps –∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
            data.predictions.forEach(row => {
                const timeStr = row['–í—Ä–µ–º—è —Ç—Ä–∏–≥–≥–µ—Ä–∞'];
                if (timeStr) {
                    const timestamp = new Date(timeStr);
                    if (!isNaN(timestamp.getTime())) {
                        timestamps.push(timestamp);
                    }
                }
            });
            
            if (timestamps.length === 0) {
                console.warn('No timestamps found in data');
                timeMachineState.enabled = false;
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º timestamps
            timestamps.sort((a, b) => a - b);
            
            timeMachineState.allTimestamps = timestamps;
            timeMachineState.minTime = timestamps[0];
            timeMachineState.maxTime = timestamps[timestamps.length - 1];
            timeMachineState.currentActiveTime = timeMachineState.maxTime;
            timeMachineState.enabled = true;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º Timeline Scrubber
            const scrubber = document.getElementById('timeline-scrubber');
            if (scrubber) {
                scrubber.classList.add('active');
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º UI
            updateTimelineUI();
            
            console.log(`Time Machine initialized: ${timestamps.length} timestamps from ${formatTimestamp(timeMachineState.minTime)} to ${formatTimestamp(timeMachineState.maxTime)}`);
        }
        
        /**
         * –§–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –¥–æ –∏–ª–∏ –≤ –º–æ–º–µ–Ω—Ç currentActiveTime)
         */
        function filterDataByTime(data) {
            if (!timeMachineState.enabled || !timeMachineState.currentActiveTime) {
                return data;
            }
            
            const cutoffTime = timeMachineState.currentActiveTime;
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º submit –ø–æ –≤—Ä–µ–º–µ–Ω–∏ WARNING (–∏—Å–ø–æ–ª—å–∑—É–µ–º '–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –∞–Ω–æ–º–∞–ª–∏–∏')
            const filteredSubmit = data.submit.filter(row => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –∞–Ω–æ–º–∞–ª–∏–∏ (WARNING) - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —ç—Ç–∞ –∫–æ–ª–æ–Ω–∫–∞
                const warningLog = row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –∞–Ω–æ–º–∞–ª–∏–∏'];
                if (warningLog) {
                    const warningTimestamp = parseTimestamp(warningLog);
                    if (warningTimestamp && warningTimestamp <= cutoffTime) {
                        return true;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –ø—Ä–æ–±–ª–µ–º—ã (ERROR) - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                const errorLog = row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –ø—Ä–æ–±–ª–µ–º—ã'] || row['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞'];
                if (errorLog) {
                    const errorTimestamp = parseTimestamp(errorLog);
                    if (errorTimestamp && errorTimestamp <= cutoffTime) {
                        return true;
                    }
                }
                
                return false;
            });
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º predictions
            const filteredPredictions = data.predictions.filter(row => {
                const timeStr = row['–í—Ä–µ–º—è —Ç—Ä–∏–≥–≥–µ—Ä–∞'];
                if (!timeStr) return false;
                const timestamp = new Date(timeStr);
                return !isNaN(timestamp.getTime()) && timestamp <= cutoffTime;
            });
            
            // –ê–Ω–æ–º–∞–ª–∏–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ–º (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ)
            const filteredNovel = data.novel;
            
            return {
                submit: filteredSubmit,
                predictions: filteredPredictions,
                novel: filteredNovel,
                playbooks: data.playbooks
            };
        }
        
        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç UI —ç–ª–µ–º–µ–Ω—Ç—ã Timeline Scrubber
         */
        function updateTimelineUI() {
            if (!timeMachineState.enabled) return;
            
            const timeDisplay = document.getElementById('current-time-text');
            const slider = document.getElementById('timeline-slider');
            const progress = document.getElementById('timeline-progress');
            
            if (timeDisplay) {
                timeDisplay.textContent = formatTimestamp(timeMachineState.currentActiveTime);
            }
            
            if (slider && timeMachineState.minTime && timeMachineState.maxTime) {
                const totalDuration = timeMachineState.maxTime - timeMachineState.minTime;
                const currentOffset = timeMachineState.currentActiveTime - timeMachineState.minTime;
                const percentage = totalDuration > 0 ? (currentOffset / totalDuration) * 100 : 100;
                
                slider.value = percentage;
                
                if (progress) {
                    progress.style.width = percentage + '%';
                }
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º auto_load=true
        // –ò –ø–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ from_analysis=true
        window.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (urlParams.get('from_analysis') === 'true') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                setTimeout(showToast, 500);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            if (urlParams.get('auto_load') === 'true') {
                await loadLatestResults();
            }
        });
        
        async function loadLatestResults() {
            document.getElementById('loading').classList.add('active');
            document.getElementById('empty-state').style.display = 'none';
            
            try {
                const response = await fetch('/api/latest-results');
                const result = await response.json();
                
                if (result.error) {
                    alert('–û—à–∏–±–∫–∞: ' + result.error);
                    document.getElementById('loading').classList.remove('active');
                    document.getElementById('empty-state').style.display = 'block';
                    return;
                }
                
                currentData = {
                    submit: result.data['submit_report.xlsx'] || [],
                    predictions: result.data['predictive_alerts.xlsx'] || [],
                    novel: result.data['novel_anomalies.xlsx'] || [],
                    playbooks: result.data['playbooks_recommendations.csv'] || []
                };
                
                // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log('=== LOADED DATA DEBUG ===');
                console.log(`Errors (submit): ${currentData.submit.length}`);
                console.log(`Predictions: ${currentData.predictions.length}`);
                console.log(`Novel anomalies: ${currentData.novel.length}`);
                if (currentData.novel.length > 0) {
                    console.log('First anomaly record:', currentData.novel[0]);
                    console.log('Anomaly fields:', Object.keys(currentData.novel[0]));
                }
                console.log('========================');
                
                renderDashboard(currentData);
                
                document.getElementById('loading').classList.remove('active');
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('download-btn').style.display = 'inline-block';
                
            } catch (error) {
                console.error('Error loading results:', error);
                document.getElementById('loading').classList.remove('active');
                document.getElementById('empty-state').style.display = 'block';
            }
        }
        
        function renderDashboard(data, skipTimeMachineInit = false) {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Time Machine (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ)
            if (!skipTimeMachineInit) {
                initializeTimeMachine(data);
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            const filteredData = filterDataByTime(data);
            
            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
            Object.values(chartsInstances).forEach(chart => chart.destroy());
            chartsInstances = {};
            
            // KPI Cards
            updateKPIs(filteredData);
            
            // Charts
            renderTimelineChart(filteredData);
            renderImpactChart(filteredData);
            renderSystemsChart(filteredData);
            
            // Table
            renderIncidentsTable(filteredData);
        }
        
        function updateKPIs(data) {
            // –ü–æ–¥—Å—á–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
            const uniqueProblems = new Set(data.submit.map(r => r['ID –ø—Ä–æ–±–ª–µ–º—ã'])).size;
            document.getElementById('kpi-problems').textContent = uniqueProblems;
            
            // –ü–æ–¥—Å—á–µ—Ç –∞–Ω–æ–º–∞–ª–∏–π (WARNING –ª–æ–≥–æ–≤)
            document.getElementById('kpi-anomalies').textContent = data.submit.length;
            
            // –ü–æ–¥—Å—á–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
            document.getElementById('kpi-predictions').textContent = data.predictions.length;
            
            // –ü–æ–¥—Å—á–µ—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å–∏—Å—Ç–µ–º
            const uniqueSystems = new Set(data.submit.map(r => r['–§–∞–π–ª —Å –ø—Ä–æ–±–ª–µ–º–æ–π'])).size;
            document.getElementById('kpi-systems').textContent = uniqueSystems;
        }
        
        function renderTimelineChart(data) {
            const ctx = document.getElementById('timeline-chart').getContext('2d');
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏
            const timePoints = new Map();
            
            // 1. ERROR –∏–∑ submit_report (–±–µ—Ä–µ–º –∏–∑ '–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –ø—Ä–æ–±–ª–µ–º—ã' –∏–ª–∏ '–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞')
            // –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–Ø: —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ERROR (–ø–æ –ø–æ–ª–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –ª–æ–≥–∞)
            const uniqueErrors = new Set();
            const errorTimes = [];
            data.submit.forEach(row => {
                // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
                const errorLog = row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –ø—Ä–æ–±–ª–µ–º—ã'] || row['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞'];
                if (errorLog && !uniqueErrors.has(errorLog)) {
                    uniqueErrors.add(errorLog);
                    const timestamp = parseTimestamp(errorLog);
                    if (timestamp) {
                        errorTimes.push(timestamp);
                        const hourKey = `${timestamp.getHours()}:00`;
                        if (!timePoints.has(hourKey)) {
                            timePoints.set(hourKey, { errors: 0, warnings: 0, predictions: 0 });
                        }
                        timePoints.get(hourKey).errors++;
                    }
                }
            });
            
            // 2. WARNING –∏–∑ submit_report (–±–µ—Ä–µ–º –∏–∑ '–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –∞–Ω–æ–º–∞–ª–∏–∏' –∏–ª–∏ '–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞')
            const warningTimes = [];
            data.submit.forEach(row => {
                // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –∏–∑ –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –∏–∑ —Å—Ç–∞—Ä–æ–π (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
                const warningLog = row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –∞–Ω–æ–º–∞–ª–∏–∏'] || row['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞'];
                if (warningLog) {
                    const timestamp = parseTimestamp(warningLog);
                    if (timestamp) {
                        warningTimes.push(timestamp);
                        const hourKey = `${timestamp.getHours()}:00`;
                        if (!timePoints.has(hourKey)) {
                            timePoints.set(hourKey, { errors: 0, warnings: 0, predictions: 0 });
                        }
                        timePoints.get(hourKey).warnings++;
                    }
                }
            });
            
            // 3. –ü–†–û–ì–ù–û–ó–´ –∏–∑ predictive_alerts (–±–µ—Ä–µ–º –∏–∑ –ø–æ–ª—è '–í—Ä–µ–º—è —Ç—Ä–∏–≥–≥–µ—Ä–∞')
            data.predictions.forEach(row => {
                const timeStr = row['–í—Ä–µ–º—è —Ç—Ä–∏–≥–≥–µ—Ä–∞'];
                if (timeStr) {
                    const timestamp = new Date(timeStr);
                    if (!isNaN(timestamp.getTime())) {
                        const hourKey = `${timestamp.getHours()}:00`;
                        if (!timePoints.has(hourKey)) {
                            timePoints.set(hourKey, { errors: 0, warnings: 0, predictions: 0 });
                        }
                        timePoints.get(hourKey).predictions++;
                    }
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ —á–∞—Å–æ–≤ (24 —á–∞—Å–∞)
            const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
            const errorCounts = hours.map(h => timePoints.get(h)?.errors || 0);
            const warningCounts = hours.map(h => timePoints.get(h)?.warnings || 0);
            const predictionCounts = hours.map(h => timePoints.get(h)?.predictions || 0);
            
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (window.timelineChart) {
                window.timelineChart.destroy();
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å —Ç—Ä–µ–º—è –ª–∏–Ω–∏—è–º–∏
            window.timelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: 'üî¥ ERROR (–ü—Ä–æ–±–ª–µ–º—ã)',
                            data: errorCounts,
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            tension: 0.3,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: 'rgba(239, 68, 68, 1)'
                        },
                        {
                            label: 'üü† WARNING (–ê–Ω–æ–º–∞–ª–∏–∏)',
                            data: warningCounts,
                            borderColor: 'rgba(251, 146, 60, 1)',
                            backgroundColor: 'rgba(251, 146, 60, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: 'rgba(251, 146, 60, 1)'
                        },
                        {
                            label: 'üíõ –ü–†–û–ì–ù–û–ó–´',
                            data: predictionCounts,
                            borderColor: 'rgba(234, 179, 8, 1)',
                            backgroundColor: 'rgba(234, 179, 8, 0.05)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            tension: 0.3,
                            fill: false,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: 'rgba(234, 179, 8, 1)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#FF994E',
                                font: {
                                    family: 'Orbitron',
                                    size: 12,
                                    weight: '600'
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 10, 10, 0.95)',
                            titleColor: '#FF994E',
                            bodyColor: '#FFFFFF',
                            borderColor: '#FF994E',
                            borderWidth: 1,
                            titleFont: {
                                family: 'Orbitron',
                                size: 14
                            },
                            bodyFont: {
                                family: 'Roboto Mono',
                                size: 13
                            },
                            padding: 12,
                            callbacks: {
                                title: function(context) {
                                    return `–í—Ä–µ–º—è: ${context[0].label}`;
                                },
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    return `${label}: ${value} ${value === 1 ? '—Å–æ–±—ã—Ç–∏–µ' : '—Å–æ–±—ã—Ç–∏–π'}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 153, 78, 0.1)',
                                borderColor: '#FF994E'
                            },
                            ticks: {
                                color: '#FF994E',
                                font: {
                                    family: 'Roboto Mono',
                                    size: 11
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 153, 78, 0.1)',
                                borderColor: '#FF994E'
                            },
                            ticks: {
                                color: '#FF994E',
                                font: {
                                    family: 'Roboto Mono',
                                    size: 11
                                },
                                precision: 0,
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            console.log(`Timeline chart rendered: ${errorCounts.reduce((a,b)=>a+b,0)} ERROR, ${warningCounts.reduce((a,b)=>a+b,0)} WARNING, ${predictionCounts.reduce((a,b)=>a+b,0)} PREDICTIONS`);
        }
        
        function renderImpactChart(data) {
            const ctx = document.getElementById('impact-chart').getContext('2d');
            
            // –ü–æ–¥—Å—á–µ—Ç Impact Score –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã
            const problemStats = {};
            data.submit.forEach(row => {
                const problemId = row['ID –ø—Ä–æ–±–ª–µ–º—ã'];
                if (!problemStats[problemId]) {
                    problemStats[problemId] = {
                        count: 0,
                        systems: new Set()
                    };
                }
                problemStats[problemId].count++;
                problemStats[problemId].systems.add(row['–§–∞–π–ª —Å –ø—Ä–æ–±–ª–µ–º–æ–π']);
            });
            
            // –†–∞—Å—á–µ—Ç Impact Score –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            const problemsWithImpact = Object.entries(problemStats)
                .map(([id, stats]) => ({
                    id: parseInt(id),
                    impact: stats.count * stats.systems.size
                }))
                .sort((a, b) => b.impact - a.impact)
                .slice(0, 8);
            
            const labels = problemsWithImpact.map(p => PROBLEM_NAMES[p.id] || `–ü—Ä–æ–±–ª–µ–º–∞ ${p.id}`);
            const values = problemsWithImpact.map(p => p.impact);
            
            chartsInstances.impact = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–°—Ç–µ–ø–µ–Ω—å –≤–ª–∏—è–Ω–∏—è',
                        data: values,
                        backgroundColor: 'rgba(255, 153, 78, 0.8)',
                        borderColor: '#FF994E',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 10, 10, 0.95)',
                            titleColor: '#FF994E',
                            bodyColor: '#FFFFFF',
                            borderColor: '#FF994E',
                            borderWidth: 1,
                            titleFont: {
                                family: 'Orbitron'
                            },
                            bodyFont: {
                                family: 'Roboto Mono'
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 153, 78, 0.1)',
                                borderColor: '#FF994E'
                            },
                            ticks: {
                                color: '#FF994E',
                                font: {
                                    family: 'Roboto Mono'
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 153, 78, 0.1)',
                                borderColor: '#FF994E'
                            },
                            ticks: {
                                color: '#FF994E',
                                font: {
                                    family: 'Roboto Mono',
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderSystemsChart(data) {
            const ctx = document.getElementById('systems-chart').getContext('2d');
            
            const systemCounts = {};
            data.submit.forEach(row => {
                const system = row['–§–∞–π–ª —Å –ø—Ä–æ–±–ª–µ–º–æ–π'];
                systemCounts[system] = (systemCounts[system] || 0) + 1;
            });
            
            const sortedSystems = Object.entries(systemCounts)
                .sort((a, b) => b[1] - a[1]);
            
            const labels = sortedSystems.map(([sys, _]) => SYSTEM_NAMES[sys] || sys);
            const values = sortedSystems.map(([_, count]) => count);
            
            chartsInstances.systems = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã',
                        data: values,
                        backgroundColor: [
                            'rgba(255, 65, 54, 0.8)',
                            'rgba(255, 165, 0, 0.8)',
                            'rgba(255, 220, 0, 0.8)',
                            'rgba(255, 153, 78, 0.8)',
                            'rgba(255, 153, 78, 0.8)'
                        ],
                        borderColor: [
                            '#FF4136',
                            '#FFA500',
                            '#FFDC00',
                            '#FF994E',
                            '#FF994E'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 10, 10, 0.95)',
                            titleColor: '#FF994E',
                            bodyColor: '#FFFFFF',
                            borderColor: '#FF994E',
                            borderWidth: 1,
                            titleFont: {
                                family: 'Orbitron'
                            },
                            bodyFont: {
                                family: 'Roboto Mono'
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 153, 78, 0.1)',
                                borderColor: '#FF994E'
                            },
                            ticks: {
                                color: '#FF994E',
                                font: {
                                    family: 'Roboto Mono'
                                },
                                precision: 0
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 153, 78, 0.1)',
                                borderColor: '#FF994E'
                            },
                            ticks: {
                                color: '#FF994E',
                                font: {
                                    family: 'Roboto Mono',
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderIncidentsTable(data) {
            const tbody = document.getElementById('incidents-tbody');
            tbody.innerHTML = '';
            
            // –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º
            const problemStats = {};
            data.submit.forEach(row => {
                const problemId = row['ID –ø—Ä–æ–±–ª–µ–º—ã'];
                if (!problemStats[problemId]) {
                    problemStats[problemId] = {
                        count: 0,
                        systems: new Set(),
                        file: row['–§–∞–π–ª —Å –ø—Ä–æ–±–ª–µ–º–æ–π'],
                        line: row['‚Ññ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã'] || row['‚Ññ —Å—Ç—Ä–æ–∫–∏'],  // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                        log: row['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –ø—Ä–æ–±–ª–µ–º—ã'] || row['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞']  // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                    };
                }
                problemStats[problemId].count++;
                problemStats[problemId].systems.add(row['–§–∞–π–ª —Å –ø—Ä–æ–±–ª–µ–º–æ–π']);
            });
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ Impact Score
            const sortedProblems = Object.entries(problemStats)
                .map(([id, stats]) => ({
                    id: parseInt(id),
                    ...stats,
                    impact: stats.count * stats.systems.size
                }))
                .sort((a, b) => b.impact - a.impact)
                .slice(0, 15);
            
            sortedProblems.forEach(problem => {
                const playbook = data.playbooks.find(p => p['ID –ø—Ä–æ–±–ª–µ–º—ã'] == problem.id);
                const priority = playbook?.['–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç'] || 'Unknown';
                const problemName = PROBLEM_NAMES[problem.id] || `–ü—Ä–æ–±–ª–µ–º–∞ ${problem.id}`;
                
                const tr = document.createElement('tr');
                tr.onclick = () => openIncidentExplorer(problem, playbook, data);
                
                tr.innerHTML = `
                    <td>${problem.id}</td>
                    <td>${problemName}</td>
                    <td>${problem.count}</td>
                    <td>${problem.systems.size}</td>
                    <td><strong>${problem.impact}</strong></td>
                    <td><span class="badge badge-${priority.toLowerCase()}">${priority}</span></td>
                    <td><button class="btn" style="padding: 6px 12px; font-size: 0.8em;" onclick="event.stopPropagation(); openIncidentExplorer(${JSON.stringify(problem).replace(/"/g, '&quot;')}, ${JSON.stringify(playbook).replace(/"/g, '&quot;')}, currentData)">üîç –û–ë–ó–û–†</button></td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        function openIncidentExplorer(problem, playbook, data) {
            const modal = document.getElementById('incident-modal');
            const title = document.getElementById('modal-title');
            const priorityBadge = document.getElementById('modal-priority-badge');
            const rootCause = document.getElementById('modal-root-cause');
            const context = document.getElementById('modal-context');
            const playbookEl = document.getElementById('modal-playbook');
            const timeline = document.getElementById('modal-timeline');
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            const problemName = PROBLEM_NAMES[problem.id] || `–ü—Ä–æ–±–ª–µ–º–∞ ${problem.id}`;
            title.textContent = `–ò–ù–¶–ò–î–ï–ù–¢: ${problemName}`;
            
            // Priority Badge
            const priority = playbook?.['–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç'] || 'Unknown';
            priorityBadge.textContent = priority;
            priorityBadge.className = `badge badge-${priority.toLowerCase()}`;
            
            // Root Cause (ERROR –ª–æ–≥)
            rootCause.innerHTML = `
                <div class="log-line">–§–∞–π–ª: ${problem.file}</div>
                <div class="log-line">–°—Ç—Ä–æ–∫–∞: ${problem.line}</div>
                <div class="log-line highlight">${problem.log}</div>
            `;
            
            // Context (—Å–∏–º—É–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
            const contextLines = [
                `${problem.line - 2}| [INFO] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞`,
                `${problem.line - 1}| [WARNING] –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏`,
                `${problem.line}| [ERROR] ${problem.log}`,
                `${problem.line + 1}| [ERROR] –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞`,
                `${problem.line + 2}| [INFO] –ò–Ω—Ü–∏–¥–µ–Ω—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞`
            ];
            
            context.innerHTML = contextLines.map((line, idx) => 
                `<div class="log-line ${idx === 2 ? 'highlight' : ''}">${line}</div>`
            ).join('');
            
            // Playbook
            if (playbook && playbook['–®–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è']) {
                const steps = playbook['–®–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è'].split(' | ');
                playbookEl.innerHTML = steps.map(step => `<li>${step}</li>`).join('');
            } else {
                playbookEl.innerHTML = '<li>–®–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã</li>';
            }
            
            // Timeline (WARNING –ª–æ–≥–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π)
            const relatedWarnings = data.submit.filter(r => r['ID –ø—Ä–æ–±–ª–µ–º—ã'] === problem.id).slice(0, 5);
            
            if (relatedWarnings.length > 0) {
                timeline.innerHTML = relatedWarnings.map((warning, idx) => `
                    <div class="timeline-item">
                        <div class="timeline-time">T+${idx * 3}—Å</div>
                        <div class="timeline-content">${warning['–°—Ç—Ä–æ–∫–∞ –ª–æ–≥–∞ –∞–Ω–æ–º–∞–ª–∏–∏'] || warning['–°—Ç—Ä–æ–∫–∞ –∏–∑ –ª–æ–≥–∞']}</div>
                    </div>
                `).join('');
            } else {
                timeline.innerHTML = '<div class="timeline-item"><div class="timeline-content">–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div></div>';
            }
            
            modal.classList.add('active');
        }
        
        function closeIncidentModal() {
            const modal = document.getElementById('incident-modal');
            modal.classList.remove('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('incident-modal');
            if (event.target == modal) {
                closeIncidentModal();
            }
        }
        
        // ========== TIME MACHINE EVENT HANDLERS ==========
        
        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∑—É–Ω–∫–∞ —Å debounce
         */
        const handleSliderChange = debounce((percentage) => {
            if (!timeMachineState.enabled || !currentData) return;
            
            const totalDuration = timeMachineState.maxTime - timeMachineState.minTime;
            const offset = (percentage / 100) * totalDuration;
            timeMachineState.currentActiveTime = new Date(timeMachineState.minTime.getTime() + offset);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateTimelineUI();
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–∞—à–±–æ—Ä–¥ —Å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            renderDashboard(currentData, true); // skipTimeMachineInit = true
            
            console.log(`Time Machine: jumped to ${formatTimestamp(timeMachineState.currentActiveTime)}`);
        }, 200); // 200ms debounce
        
        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –Ω–∞ —Å–ª–∞–π–¥–µ—Ä–µ (–±–µ–∑ debounce –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏)
         */
        function handleSliderInput(event) {
            const percentage = parseFloat(event.target.value);
            const progress = document.getElementById('timeline-progress');
            if (progress) {
                progress.style.width = percentage + '%';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –±–µ–∑ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
            if (timeMachineState.enabled && timeMachineState.minTime && timeMachineState.maxTime) {
                const totalDuration = timeMachineState.maxTime - timeMachineState.minTime;
                const offset = (percentage / 100) * totalDuration;
                const previewTime = new Date(timeMachineState.minTime.getTime() + offset);
                
                const timeDisplay = document.getElementById('current-time-text');
                if (timeDisplay) {
                    timeDisplay.textContent = formatTimestamp(previewTime);
                }
            }
        }
        
        /**
         * Play/Pause —Ñ—É–Ω–∫—Ü–∏—è
         */
        function togglePlayPause() {
            const playBtn = document.getElementById('timeline-play-btn');
            
            if (timeMachineState.isPlaying) {
                // PAUSE
                timeMachineState.isPlaying = false;
                if (timeMachineState.playInterval) {
                    clearInterval(timeMachineState.playInterval);
                    timeMachineState.playInterval = null;
                }
                playBtn.textContent = '‚ñ∂ PLAY';
                playBtn.classList.remove('playing');
                console.log('Time Machine: paused');
            } else {
                // PLAY
                timeMachineState.isPlaying = true;
                playBtn.textContent = '‚è∏ PAUSE';
                playBtn.classList.add('playing');
                
                // –ï—Å–ª–∏ –º—ã –Ω–∞ –∫–æ–Ω—Ü–µ, –Ω–∞—á–∏–Ω–∞–µ–º —Å–Ω–∞—á–∞–ª–∞
                if (timeMachineState.currentActiveTime >= timeMachineState.maxTime) {
                    timeMachineState.currentActiveTime = timeMachineState.minTime;
                }
                
                console.log('Time Machine: playing');
                
                // –ê–Ω–∏–º–∞—Ü–∏—è: –¥–≤–∏–≥–∞–µ–º –≤—Ä–µ–º—è –≤–ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–µ 500ms
                timeMachineState.playInterval = setInterval(() => {
                    if (!timeMachineState.enabled || !currentData) {
                        togglePlayPause(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                        return;
                    }
                    
                    const totalDuration = timeMachineState.maxTime - timeMachineState.minTime;
                    const step = totalDuration / 50; // 50 —à–∞–≥–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞
                    
                    timeMachineState.currentActiveTime = new Date(
                        timeMachineState.currentActiveTime.getTime() + step
                    );
                    
                    // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è
                    if (timeMachineState.currentActiveTime >= timeMachineState.maxTime) {
                        timeMachineState.currentActiveTime = timeMachineState.maxTime;
                        togglePlayPause();
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–∞—à–±–æ—Ä–¥
                    updateTimelineUI();
                    renderDashboard(currentData, true);
                    
                }, 500); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 500ms
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            const slider = document.getElementById('timeline-slider');
            const playBtn = document.getElementById('timeline-play-btn');
            
            if (slider) {
                // Input —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
                slider.addEventListener('input', handleSliderInput);
                
                // Change —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞ —Å debounce
                slider.addEventListener('change', (event) => {
                    const percentage = parseFloat(event.target.value);
                    handleSliderChange(percentage);
                });
            }
            
            if (playBtn) {
                playBtn.addEventListener('click', togglePlayPause);
            }
            
            console.log('Time Machine event handlers initialized');
        });
    </script>
</body>
</html>
